<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: sessionsdb.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: sessionsdb.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>//Set up database connections
var mongoose = require("mongoose");
mongoose.connect("mongodb://localhost/collaborativereader", {
    useNewUrlParser: true
});

//Create model for session
var Session = mongoose.model("Session", {
    name: String,
    owner: String,
    currentBook: {
        bookDetails: {
            bookId: Number,
            bookName: String
        },
        pageNum: Number,
        notes: [{
            pageNum: Number,
            note: String
        }]
    },
    users: [{
        userId: String
    }]
});

/**
 * Callback used when accessing Session from MongoDB
 * 
 * @callback sessionCallback
 * @param {object} err - The error returned from MongoDB access
 * @param {object} result - The result returned from MongoDB access
 */

 /**
 * Gets all of the Sessions from MongoDB
 *
 * @param {sessionCallback} callback - A callback to run after database access.
 */
var getAllSessions = function (callback) {
    Session.find().exec(callback);
};
 /**
 * Returns the session with a given id.
 *
 * @param {string} sessionId - The id of the session you want to retrieve.
 * @param {sessionCallback} callback - A callback to run after database access.
 */
var getSessionById = function (sessionId, callback) {
    Session.findOne({
        _id: sessionId
    }).exec(callback);
};

 /**
 * Join a session
 *
 * @param {string} sessionId - The id of the session to be joined
 * @param {string} userId - The id of the user that is attempting to join the session
 * @param {sessionCallback} callback - A callback to run after database access.
 */
var joinSession = function (sessionId, userId, callback) {
    Session.findOneAndUpdate({
        _id: sessionId
    }, {
        "$push": {
            "users": {
                userId: userId
            }
        }
    }, callback);
};

 /**
 * Creates a new session
 *
 * @param {string} sessionName - The user input name of the new session
 * @param {string} userId - The id of the user that is attempting to create the session. Will be set as the owner of the session
 * @param {string} bookId - The id of the book being to be viewed in the session.
 * @param {sessionCallback} callback - A callback to run after database access.
 */
var createSession = function (sessionName, userId, bookId, callback) {
    var newSession = new Session({
        name: sessionName,
        owner: userId,
        currentBook: {
            bookDetails: {
                bookId: bookId,
                bookName: bookId
            },
            pageNum: 0,
            notes: []
        },
        users: [{
            userId: userId
        }]
    });

    newSession.save(callback);
}


module.exports = {
    getAllSessions: getAllSessions,
    getSessionById: getSessionById,
    joinSession: joinSession,
    createSession: createSession
};</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#createSession">createSession</a></li><li><a href="global.html#getAllSessions">getAllSessions</a></li><li><a href="global.html#getSessionById">getSessionById</a></li><li><a href="global.html#joinSession">joinSession</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Wed Nov 21 2018 18:51:58 GMT+0000 (GMT Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
