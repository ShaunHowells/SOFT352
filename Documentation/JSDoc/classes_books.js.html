<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: classes/books.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: classes/books.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @classdesc Handles all of the functionality relating to the handling of multiple 'Books'
 * 
 * @class
 * @hideconstructor
 */
const Books = (function () { // eslint-disable-line no-unused-vars
    
    var currentUserId; //ID of the current user
    var bookList = []; //Stores the list of retrieved books
    const defaultPage = { //The default page to be displayed when not in a session
        src: "testimage.jpg",
        pageNum: 0
    };
    var currentPage = new Page(defaultPage); //The current page being displayed - Default value is set to default page

    var bookListObserver = new Observer();
    var updatePageObserver = new Observer();

    /**
     * Returns bookListObserver
     * 
     * @memberof Books
     * @return {Observer} Observer for the bookList
     */
    function getBookListObserver() {
        return bookListObserver;
    }
    /**
     * Returns updatePageObserver
     * 
     * @memberof Books
     * @return {Observer} Observer for updating the current page
     */
    function getUpdatePageObserver() {
        return updatePageObserver;
    }


    /**
     * Sets the current user id - Value may only be set once
     * 
     * @param {String} newUserId - ID to set currentUserID as
     * @memberof Books
     */
    function setCurrentUserId(newUserId) {
        if (!currentUserId) {
            currentUserId = newUserId;
        } else {
            console.error("Current User Id may only be set once");
        }
    }
    /**
     * Returns currentUserId
     * 
     * @return {String} The current User ID
     * @memberof Books
     */
    function getCurrentUserId() {
        return currentUserId;
    }

    /**
     * Sends a request to the server to retrieve the list of all books
     * NOTE: This retrieves basic information about each book to avoid the amount
     * of bandwidth required to transfer all of the images stored in each 'Book'
     * 
     * @memberof Books
     */
    function retrieveBookList() {
        var self = this;
        $.post("http://localhost:9000/books/getallbooks", {}).done(function (data) {
            if (data.success) {
                self.setBookList(data.result);
            } else {
                alert("An error has occured when retrieving book list. Please try again");
                console.log(data);
            }
        });
    };

    /**
     * Sends a request to the server to retrieve the list of all books
     * NOTE: This retrieves basic information about each book to avoid the amount
     * of bandwidth required to transfer all of the images stored in each 'Book'
     * 
     * @param {Object[]} books - An array of objects containing the basic information about a set of books 
     * @memberof Books
     */
    function setBookList(books) {
        bookList = [];

        for (var book in books) {
            bookList.push(new Book(books[book]));
        }
        bookListObserver.notify(bookList);
    };

    /**
     * Returns the bookList
     * 
     * @returns {Book[]} The current list of books
     * @memberof Books
     */
    function getBookList() {
        return bookList;
    };

    /**
     * Gets the page data for a page in a book
     * 
     * @param {String} bookId - ID of the book containing the page
     * @param {Integer} pageNum - Number of the page (starts from 0)
     * @memberof Books
     */
    function getBookPage(bookId, pageNum) {
        if (bookId &amp;&amp; pageNum != null) {
            var self = this;
            for (var book in bookList) {
                if (bookList[book]._id == bookId) {
                    bookList[book].getPageData(pageNum, function (data) {
                        self.updateDisplayedPage(data);
                    });
                    break;
                }
            }
        }
    };
    /**
     * Checks that the page data is correct, then calls the setPageCallback
     * 
     * @param {Object} data - Data of the book + page
     */
    function updateDisplayedPage(data) {
        if (data.pages &amp;&amp; data.pages.length == 1) {
            currentPage = new Page(data.pages[0]);

            updatePageObserver.notify(currentPage);
        } else {
            console.error("Page data is not in the expected format");
        }
    };

    /**
     * Sets currentPage. Used when the page needs to be set to a local image (using a filename rather than a buffer)
     * 
     * @param {Object} newPage - Details of the page to set as the current page
     * @memberof Books
     */
    function setCurrentPage(newPage) {
        currentPage = new Page(newPage);

        updatePageObserver.notify(currentPage);
    };
    /**
     * Returns currentPage
     * 
     * @returns {Page} The currently displayed page
     * @memberof Books
     */
    function getCurrentPage() {
        return currentPage;
    };
    /**
     * Resets the currentPage to the default page
     * 
     * @memberof Books
     */
    function resetPage() {
        setCurrentPage(defaultPage);
    }

    return {
        getBookListObserver: getBookListObserver,
        getUpdatePageObserver: getUpdatePageObserver,
        setCurrentUserId: setCurrentUserId,
        getCurrentUserId: getCurrentUserId,
        retrieveBookList: retrieveBookList,
        setBookList: setBookList,
        getBookList: getBookList,
        getBookPage: getBookPage,
        updateDisplayedPage: updateDisplayedPage,
        setCurrentPage: setCurrentPage,
        getCurrentPage: getCurrentPage,
        resetPage: resetPage
    };
})();

/**
 * Handles all of the functionality related to an individual book
 * @constructor
 */
function Book(bookDetails) {
    this.title = bookDetails.title; //Title of the book
    this._id = bookDetails._id; //_id of the book

    /**
     * Retrieves the data of a given page of the book
     * @param {Integer} pageNum - The number of the page you want to retrieve
     * @param {Function} callback - The function to execute after the page is successfully retrieved
     */
    this.getPageData = function (pageNum, callback) {
        var self = this;
        $.post("http://localhost:9000/books/getpagefrombook", {
            bookId: this._id,
            pageNum: pageNum
        }).done(function (data) {
            if (data.success) {
                callback(data.result);
            } else {
                alert("An error has occured retrieving the page data. Please try again");
                console.log(data);
            }
        });
    }
}
/**
 * Handles all of the functionality related to an individual page
 * @constructor
 */
function Page(pageDetails) {
    //Page src can come in two formats
    //Name of local files or the image data
    if (pageDetails.src) {
        this.src = pageDetails.src;
    } else if (pageDetails.data.data) {
        this.src = "data:" + pageDetails.contentType + ";base64," + util_encode(pageDetails.data.data);
    }

    this.pageNum = pageDetails.pageNum; //Number of the page
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Book.html">Book</a></li><li><a href="Books.html">Books</a></li><li><a href="CollabBookReader.html">CollabBookReader</a></li><li><a href="Page.html">Page</a></li><li><a href="Session.html">Session</a></li><li><a href="Sessions.html">Sessions</a></li></ul><h3>Global</h3><ul><li><a href="global.html#AngularMainApp">AngularMainApp</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Thu Dec 13 2018 19:02:51 GMT+0000 (GMT Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
