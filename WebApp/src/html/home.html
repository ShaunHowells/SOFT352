<html>

<head>
    <meta charset="utf-8">
    <title>Home - CBR</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
    <link rel="stylesheet" href="../css/home.css">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
    <!-- <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script> -->
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.js"></script>
    <script src="http://cdn.jsdelivr.net/npm/pouchdb@7.0.0/dist/pouchdb.min.js"></script>

    <!-- Set up util classes -->
    <script src="../js/util.js"></script>

    <!-- Get classes -->
    <script src="../js/classes/sessions.js"></script>
    <script src="../js/classes/book.js"></script>
    <script src="../js/classes/chat.js"></script>
    <script src="../js/classes/collabbookreader.js"></script>

    <!-- Set up angular -->
    <script src="../js/angular/angularmainapp.js"></script>
    <script src="../js/angular/book.js"></script>
    <script src="../js/angular/chat.js"></script>
    <script src="../js/angular/sessions.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/qunit/2.8.0/qunit.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qunit/2.8.0/qunit.min.js"></script>

    <script src="../../test/Qunit/tests/sessionsqunit.js"></script>
    <script src="../../test/Qunit/tests/booksqunit.js"></script>

    <!-- Start main.js after unit tests are complete -->
    <script src="../js/main.js"></script>

</head>

<body>
    <div class="page-header">
        <h1>Collaborative Book Reader - CBR</h1>
    </div>
    <div class="col-sm-8">
        <p>Welcome to the online Collaborative Book Reader, also known as CBR. What CBR allows you to
            do is
            read
            books together with other users in real time.
            When one of you selects a book to read, this will be replicated for each user.
            You can also add notes for pages and books, as well as chat with your collaboraters.
            This Web Application current supports:</p>
        <ul>
            <li>NOTHING</li>
        </ul>
    </div>
    <div class="row border main" id="main" ng-app="AngularMainApp">
        <!-- Sesssion Lists -->
        <div class="col-sm-3 sessionTabs">
            <ul id="sessionTabList" class="nav nav-tabs" role="tablist">
                <li class="nav-item active"><a id="availableSessionsTabHeading" href="#availableSessions" role="tab"
                        data-toggle="tab" class="nav-link active">Available
                        Sessions</a></li>
                <li class="nav-item"><a id="currentUserSessionTabHeading" href="#currentUserSession" role="tab"
                        data-toggle="tab" class="nav-link">My Session</a></li>
            </ul>
            <div class="tab-content sessionList">
                <!-- Available Session List -->
                <div id="availableSessions" ng-controller="availableSessionsCtrl" class="tab-pane active list-3-+group">
                    <a href="" role="button" ng-repeat="session in availableSessions" class="list-group-item list-group-item-action"
                        id="availableSessionId{{session._id}}" ng-click="showSessionDetails(session)">{{session.name}}</a>
                    <!-- Available Session Details Modal Popup -->
                    <div class="modal" id="availableSessionDetailsModal" tabindex="-1" role="dialog" aria-labelledby="availableSessionDetailsModalLabel"
                        aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="availableSessionDetailsModalLabel"><span id="displayedSessionName">{{displaySession.name}}</span></h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <p>Currently reading: <span id="displayedSessionBookTitle">{{displaySession.currentBook.title}}</span></p>
                                    <p>Owner: <span id="displayedSessionOwner">{{displaySession.owner}}</span></p>
                                    <br>
                                    <span id="canJoinSession"></span>
                                </div>
                                <div class="modal-footer">
                                    <button id="availableSessionDetailsModalClose" type="button" class="btn btn-secondary"
                                        data-dismiss="modal">Close</button>
                                    <button id="availableSessionDetailsModalJoinSession" type="button" class="btn btn-primary"
                                        ng-click="joinSession(displaySession)">Join Session</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Current User Session -->
                <div id="currentUserSession" ng-controller="currentUserSessionCtrl" class="tab-pane list-group">
                    <div id="currentUserSessionDetails">
                        <div id="currentUserSessionDetailList">
                            <input type="hidden" id="currentUserSessionId{{session._id}}">
                            <p>Current Session: <span id="currentUserSessionName">{{currentUserSession.name}}</span></p>
                            <p>Currently reading: <span id="currentUserSessionBookTitle">{{currentUserSession.currentBook.title}}</span></p>
                            <p>Owner: <span id="currentUserSessionOwner">{{currentUserSession.owner}}</span></p>
                        </div>
                        <button id="currentUserSessionDetailsLeaveSession" type="button" class="btn btn-primary leaveSession"
                            ng-click="leaveSession(currentUserSession)">Leave Session</button>
                    </div>
                    <div id="currentUserSessionJoin">
                        <button class="btn btn-primary createNewSession" id="createNewSession" ng-click="displayCreateNewSessionDetails()">Create
                            a new session</button>
                    </div>
                    <!-- Create new Session details Modal -->
                    <div class="modal" id="createNewSessionModal" tabindex="-1" role="dialog" aria-labelledby="createNewSessionModalLabel"
                        aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="createNewSessionModalLabel">Create new Session</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <p>Select the details for your new session below, the click "Create Session".</p>
                                    <div class="input-group">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text">Session Name</span>
                                        </div>
                                        <input id="createNewSessionName" type="text" placeholder="Name" class="form-control">
                                    </div>
                                    <div class="input-group">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text">Book</span>
                                        </div>
                                        <select id="createNewSessionBook" class="form-control" ng-controller="bookListCtrl">
                                            <option value="" disabled selected>--Select a book--</option>
                                            <option ng-repeat="book in bookList" value="{{book._id}}">{{book.title}}</option>>
                                        </select>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button id="createNewSessionModalClose" type="button" class="btn btn-secondary"
                                        data-dismiss="modal">Close</button>
                                    <button id="createNewSessionModalJoinSession" type="button" class="btn btn-primary"
                                        ng-click="createNewSession()">Create Session</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-sm-6">
            <!-- Book page display -->
            <div id="bookPageCarousel" data-interval="false" class="carousel slide" data-ride="carousel" ng-controller="pageCtrl">
                <div class="carousel-inner">
                    <div class="carousel-item active" id="bookPage">
                        <img id="bookPageImage" class="img-fluid border bookPageImg" ng-src="{{pageImage}}" alt="Page {{pageNum}} could not be found" />
                    </div>
                </div>
                <a class="carousel-control-prev" href="#bookPageCarousel" role="button" data-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="sr-only">Previous</span>
                </a>
                <a class="carousel-control-next" href="#bookPageCarousel" role="button" data-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="sr-only">Next</span>
                </a>
            </div>
        </div>
        <div class="col-sm-3 chatArea border">
            <!-- Book details -->
            <!-- TODO: ADD A CONTROLLER HERE -->
            <div class="bookdetails">
                <p class="text-center"><strong>Currently Reading: {{book.title}} - Page: {{page.pageNum}}</strong></p>
            </div>
            <!-- Chat message list -->
            <div id="chatMessages" ng-controller="chatMessagesCtrl" class="list-group chatMessages">
                <li ng-repeat="message in chatMessages" class="list-group-item chatMessage"><b>{{message.user}}</b>:
                    {{message.contents}}
            </div>
            <!-- Chat message input -->
            <div class="chatInput row border">
                <div class="col-sm-10">
                    <input type="text" placeholder="Enter your message here" class="chatInputMessage">
                </div>
                <div class="col-sm-2">
                    <button class="btn">Send</button>
                </div>
            </div>
        </div>
    </div>

    <div id="qunit"></div>
    <div id="qunit-fixture"></div>

</body>

</html>