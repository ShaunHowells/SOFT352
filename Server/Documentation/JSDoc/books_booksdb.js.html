<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: books/booksdb.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: books/booksdb.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>//Mongoose Models
var models;

/**
 * Callback used when accessing Books from MongoDB
 * 
 * @callback booksCallback
 * @param {Object} err - The error returned from MongoDB access
 * @param {Object} result - The result returned from MongoDB access
 */

/**
 * Adds a new book to the collection
 *
 * @param {String} title - The title of the book to be added
 * @param {Object[]} pageFiles - An array of files containing the images for each page (in order)
 * @param {booksCallback} callback - A callback to run after database access.
 */
var addNewBook = function (title, pageFiles, callback) {
    var newBook = new models.Books({
        title: title,
        pages: []
    });

    for (var page in pageFiles) {
        newBook.pages.push({
            pageNum: page,
            contentType: pageFiles[page].mimetype,
            data: pageFiles[page].buffer
        });
    }
    newBook.pageCount = newBook.pages.length;
    newBook.save(callback);
};

/**
 * Gets all of the Books from MongoDB
 *
 * @param {booksCallback} callback - A callback to run after database access.
 */
var getAllBooks = function (callback) {
    models.Books.find().select("-pages.data").exec(callback);
};

/**
 * Returns the a page from a book with a given id.
 *
 * @param {booksCallback} callback - A callback to run after database access.
 */
var getPageFromBook = function (bookId, pageNum, callback) {
    models.Books.findOne({
        "_id": bookId,
        "pages.pageNum": pageNum
    }).select({
        "title": true,
        "pageCount": true,
        "pages.$": 1
    }).exec(callback);
};
/**
 * Sets available mongoose models
 *
 * @param {Object} mongooseModels Available Mongoose models
 */
var setMongooseModels = function (mongooseModels) {
    models = mongooseModels;
};

module.exports = {
    addNewBook: addNewBook,
    getAllBooks: getAllBooks,
    getPageFromBook: getPageFromBook,
    setMongooseModels: setMongooseModels
};</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#addNewBook">addNewBook</a></li><li><a href="global.html#addNoteToSession">addNoteToSession</a></li><li><a href="global.html#changeSessionPage">changeSessionPage</a></li><li><a href="global.html#closeAllSessions">closeAllSessions</a></li><li><a href="global.html#createSession">createSession</a></li><li><a href="global.html#getAllBooks">getAllBooks</a></li><li><a href="global.html#getAllSessionNotes">getAllSessionNotes</a></li><li><a href="global.html#getAllSessions">getAllSessions</a></li><li><a href="global.html#getPageFromBook">getPageFromBook</a></li><li><a href="global.html#isUserInAnySession">isUserInAnySession</a></li><li><a href="global.html#isUserInSession">isUserInSession</a></li><li><a href="global.html#joinSession">joinSession</a></li><li><a href="global.html#removeNoteFromSession">removeNoteFromSession</a></li><li><a href="global.html#removeUserFromAllSessions">removeUserFromAllSessions</a></li><li><a href="global.html#removeUserFromSession">removeUserFromSession</a></li><li><a href="global.html#sendChatMessage">sendChatMessage</a></li><li><a href="global.html#setMongooseModels">setMongooseModels</a></li><li><a href="global.html#setWebSockets">setWebSockets</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Sat Dec 22 2018 14:44:09 GMT+0000 (GMT Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
